<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>深圳软件工具台 · 快捷入口与DID生成</title>
  <style>
    :root {
      --bg: #0b1020;
      --bg-soft: #10162b;
      --text: #e6edf7;
      --muted: #aeb8c4;
      --primary: #ffb36b;
      --primary-2: #ffd8a6;
      --card: #121a33;
      --border: #1f2a4a;
      --accent: #ffc163;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      color: var(--text);
      background:
        radial-gradient(1200px 500px at 10% -20%, rgba(255,179,107,0.25), transparent 60%),
        radial-gradient(1000px 400px at 90% -10%, rgba(255,216,166,0.20), transparent 60%),
        linear-gradient(180deg, #0a0f1d 0%, var(--bg) 40%, var(--bg) 100%);
      font: 14px/1.6 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }

    /* 顶部导航 */
    .nav { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; }
    .brand { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--text); }
    .logo { width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, var(--primary), var(--primary-2)); box-shadow: 0 8px 20px rgba(255,179,107,0.35); }
    .brand span { font-weight: 600; letter-spacing: 0.2px; }
    .nav-links { display: flex; gap: 14px; }
    .nav-links a { color: var(--muted); text-decoration: none; padding: 8px 10px; border-radius: 8px; }
    .nav-links a:hover { color: var(--text); background: #0f1730; }

    .hero { margin-top: 14px; padding: 24px; border: 1px solid var(--border); border-radius: 16px; background: linear-gradient(180deg, rgba(32,46,82,0.4), rgba(18,26,51,0.4)); }
    .hero h1 { margin: 0 0 8px; font-size: 24px; }
    .hero p { margin: 0; color: var(--muted); }
    footer { margin-top: 36px; padding: 18px; border-top: 1px solid var(--border); color: var(--muted); text-align: center; }
    .quick { margin-top: 24px; }
    .quick h2 { margin: 0 0 12px; font-size: 20px; }
    .quick-grid { display: grid; grid-template-columns: repeat(4, minmax(200px, 1fr)); gap: 12px; }
    @media (max-width: 1024px) { .quick-grid { grid-template-columns: repeat(2, minmax(200px, 1fr)); } }
    @media (max-width: 560px)  { .quick-grid { grid-template-columns: 1fr; } }
    .quick-card { display: flex; align-items: center; gap: 12px; padding: 14px; border: 1px solid var(--border); border-radius: 12px; background: var(--card); text-decoration: none; color: var(--text); }
    .quick-card:hover { border-color: var(--primary); box-shadow: 0 6px 20px rgba(255,179,107,0.20); transform: translateY(-1px); transition: all .2s ease; }
    .quick-icon { width: 34px; height: 34px; border-radius: 10px; background: linear-gradient(135deg, var(--primary), var(--primary-2)); flex: none; }
    .quick-meta { display: grid; gap: 2px; }
    .quick-name { font-weight: 600; }
    .quick-url { font-size: 12px; color: var(--muted); }
    .quick-form { margin-top: 14px; display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; }
    .quick-input { height: 34px; padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: #0f1730; color: var(--text); }
    .quick-btn { height: 34px; padding: 0 14px; border-radius: 8px; border: 1px solid var(--border); background: #3a2a14; color: var(--text); cursor: pointer; }
    .quick-btn:hover { background: #4a3317; }
    .did { margin-top: 24px; }
    .did h2 { margin: 0 0 12px; font-size: 20px; }
    .form-grid { display: grid; grid-template-columns: repeat(3, minmax(200px, 1fr)); gap: 12px; }
    @media (max-width: 960px) { .form-grid { grid-template-columns: repeat(2, minmax(200px, 1fr)); } }
    @media (max-width: 560px) { .form-grid { grid-template-columns: 1fr; } }
    .form-item { display: grid; gap: 6px; }
    .form-item label { font-size: 12px; color: var(--muted); }
    .input { height: 36px; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border); background: #0f1730; color: var(--text); }
    .btn-row { margin-top: 8px; display: flex; gap: 10px; }
    .btn { height: 36px; padding: 0 14px; border-radius: 8px; border: 1px solid var(--border); background: #3a2a14; color: var(--text); cursor: pointer; }
    .btn:hover { background: #4a3317; }
    .msg { margin-top: 10px; color: var(--accent); font-size: 12px; }
    .table-wrap { margin-top: 14px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .table-head { padding: 10px 12px; font-weight: 600; background: #3a2a14; color: #e6edf7; border-bottom: 1px solid #1f2a4a; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #1f2a4a; font-size: 13px; }
    tbody tr:nth-child(odd) { background: #0f1730; }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a class="brand" href="#"><span class="logo" aria-hidden="true"></span><span>生产SN&DID工具</span></a>
      <div class="nav-links">
        <a href="#did">DID生成</a>
      </div>
    </nav>

    

    

    <section id="did" class="did">
      <h2>DID生成工具</h2>
      <div class="form-grid">
        <div class="form-item"><label>产品类型</label><input id="type" class="input" placeholder="如：PT" /></div>
        <div class="form-item"><label>型号</label><input id="model" class="input" placeholder="如：MD100" /></div>
        <div class="form-item"><label>起始SN</label><input id="snStart" class="input" type="number" placeholder="如：1" /></div>
        <div class="form-item"><label>生成数量</label><input id="count" class="input" type="number" placeholder="如：100" /></div>
        <div class="form-item"><label>导出文件名</label><input id="fileName" class="input" placeholder="did_list.xls" value="did_list.xls" /></div>
        <div class="form-item"><label>预览条数</label><input id="previewN" class="input" type="number" value="10" /></div>
      </div>
      <div class="btn-row">
        <button id="gen" class="btn">生成预览</button>
        <button id="export" class="btn">导出.xls</button>
      </div>
      <div id="msg" class="msg"></div>
      <div class="table-wrap">
        <div class="table-head">预览</div>
        <table>
          <thead><tr><th>#</th><th>产品类型</th><th>型号</th><th>SN</th><th>First10</th><th>尾6</th><th>DID</th></tr></thead>
          <tbody id="did-body"></tbody>
        </table>
      </div>
    </section>

    

    <footer>
      © 深圳软件研发部
    </footer>
  </div>
  <script>
    
    async function sha256(str) {
      const d = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
      return new Uint8Array(d);
    }
    function pkcs7(u8) {
      const bs = 16;
      const pad = bs - (u8.length % bs || bs);
      const out = new Uint8Array(u8.length + pad);
      out.set(u8, 0);
      out.fill(pad, u8.length);
      return out;
    }
    function ab2b64(ab) {
      const u8 = new Uint8Array(ab);
      let s = '';
      for (let i = 0; i < u8.length; i++) s += String.fromCharCode(u8[i]);
      return btoa(s);
    }
    async function encTail(first10) {
      const keyBytes = await sha256('123456');
      const key = await crypto.subtle.importKey('raw', keyBytes, { name: 'AES-CBC' }, false, ['encrypt']);
      const iv = (await sha256(first10)).slice(0, 16);
      const data = pkcs7(new TextEncoder().encode(first10));
      const ct = await crypto.subtle.encrypt({ name: 'AES-CBC', iv }, key, data);
      const b64 = ab2b64(ct);
      function pickAlphaNum(s, startIdx) {
        const len = s.length;
        for (let k = 0; k < len; k++) {
          const ch = s[(startIdx + k) % len];
          if (/^[0-9A-Za-z]$/.test(ch)) return ch;
        }
        return '0';
      }
      const positions = [1, 3, 6, 10, 15, 21];
      const pick = positions.map(p => pickAlphaNum(b64, p - 1)).join('');
      return pick.toUpperCase();
    }
    function buildFirst10(type, model, sn) {
      const t = (type || '').trim();
      const m = (model || '').trim();
      const remain = 10 - (t.length + m.length);
      if (remain < 1) return null;
      const snStr = String(sn).padStart(remain, '0');
      return t + m + snStr;
    }
    async function generateRows(type, model, snStart, count) {
      const rows = [];
      for (let i = 0; i < count; i++) {
        const sn = snStart + i;
        const f10 = buildFirst10(type, model, sn);
        if (!f10) break;
        const tail6 = await encTail(f10);
        const did = f10 + tail6;
        rows.push({ idx: i + 1, type, model, sn, f10, tail6, did });
      }
      return rows;
    }
    function renderTable(rows, n) {
      const body = document.getElementById('did-body');
      body.innerHTML = '';
      rows.slice(0, n).forEach(r => {
        const tr = document.createElement('tr');
        [r.idx, r.type, r.model, r.sn, r.f10, r.tail6, r.did].forEach(v => {
          const td = document.createElement('td');
          td.textContent = v;
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }
    function exportXls(rows, name) {
      const head = ['#','产品类型','型号','SN','First10','尾6','DID'];
      const table = [head.map(h => `<th>${h}</th>`).join('')];
      rows.forEach(r => {
        table.push(['<td>'+r.idx+'</td>','<td>'+r.type+'</td>','<td>'+r.model+'</td>','<td>'+r.sn+'</td>','<td>'+r.f10+'</td>','<td>'+r.tail6+'</td>','<td>'+r.did+'</td>'].join(''));
      });
      const html = `<!DOCTYPE html><html><head><meta charset="utf-8"></head><body><table border="1"><thead><tr>${table[0]}</tr></thead><tbody>${table.slice(1).map(r=>`<tr>${r}</tr>`).join('')}</tbody></table></body></html>`;
      const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = name || 'did_list.xls';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }
    document.getElementById('gen').addEventListener('click', async () => {
      const type = document.getElementById('type').value;
      const model = document.getElementById('model').value;
      const snStart = parseInt(document.getElementById('snStart').value || '1', 10);
      const count = parseInt(document.getElementById('count').value || '1', 10);
      const previewN = parseInt(document.getElementById('previewN').value || '10', 10);
      const msg = document.getElementById('msg');
      const f10 = buildFirst10(type, model, snStart);
      if (!f10) { msg.textContent = '前10位长度不合法：产品类型+型号总长度需小于10'; return; }
      msg.textContent = '';
      const rows = await generateRows(type, model, snStart, count);
      renderTable(rows, previewN);
      window._didRows = rows;
    });
    document.getElementById('export').addEventListener('click', () => {
      const rows = window._didRows || [];
      const name = document.getElementById('fileName').value || 'did_list.xls';
      if (!rows.length) return;
      exportXls(rows, name);
    });
  </script>
</body>
</html>
